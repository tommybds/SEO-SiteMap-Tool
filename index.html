<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Audit SEO Sitemap en ligne | Analyse XML, Robots.txt et CSV</title>
  <meta id="meta-description" name="description" content="Analysez votre sitemap XML, vérifiez robots.txt, détectez les problèmes SEO techniques et exportez un rapport CSV partageable.">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <script src="analytics.local.js"></script>
  <script>
    (function initGtag() {
      const measurementId = String(window.GTAG_MEASUREMENT_ID || '').trim();
      if (!measurementId) return;

      const gtagScript = document.createElement('script');
      gtagScript.async = true;
      gtagScript.src = `https://www.googletagmanager.com/gtag/js?id=${encodeURIComponent(measurementId)}`;
      document.head.appendChild(gtagScript);

      window.dataLayer = window.dataLayer || [];
      window.gtag = function gtag() { window.dataLayer.push(arguments); };
      window.gtag('js', new Date());
      window.gtag('config', measurementId);
    })();
  </script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="title-row">
        <h1 id="app-title">SEO Sitemap Audit</h1>
        <div class="lang-switch">
          <button type="button" id="lang-fr-btn" class="lang-btn">FR</button>
          <button type="button" id="lang-en-btn" class="lang-btn">EN</button>
        </div>
      </div>
      <p id="app-subtitle">Entrez un sitemap XML. L’outil lance le script Python en arrière-plan et produit un CSV téléchargeable, avec aperçu et insights dans la page.</p>

      <div class="mode-switch" role="tablist" aria-label="Choix de fonctionnalité">
        <button type="button" id="mode-sitemap-btn" class="mode-btn active" role="tab" aria-selected="true">Audit sitemap</button>
        <button type="button" id="mode-mesh-btn" class="mode-btn" role="tab" aria-selected="false">Maillage interne</button>
      </div>
      <div id="mode-help" class="muted mode-help">Les deux sont liés: le maillage peut reprendre automatiquement le domaine du sitemap saisi.</div>

      <div id="sitemap-mode-panel">
        <form id="audit-form">
          <div>
            <label id="label-sitemap" for="sitemap">URL du sitemap</label>
            <input id="sitemap" name="sitemap" type="url" placeholder="https://example.com/sitemap.xml" required>
          </div>
          <div>
            <label id="label-max-urls" for="max_urls">Max URLs</label>
            <input id="max_urls" name="max_urls" type="number" min="1" max="5000" value="500">
          </div>
          <div>
            <label id="label-workers" for="workers">Workers</label>
            <input id="workers" name="workers" type="number" min="1" max="32" value="8">
          </div>
          <div>
            <label id="label-timeout" for="timeout">Timeout (s)</label>
            <input id="timeout" name="timeout" type="number" min="5" max="60" value="15">
          </div>
          <div class="actions" style="grid-column: 1/-1;">
            <label id="label-skip-robots"><input type="checkbox" id="skip_robots_txt" name="skip_robots_txt"> <span id="label-skip-robots-text">Ignorer robots.txt</span></label>
            <button id="run-btn" type="submit">Lancer l’audit</button>
          </div>
        </form>
        <div id="form-error" class="danger" aria-live="polite"></div>
      </div>

      <div id="mesh-mode-panel" style="display:none;">
        <form id="mesh-form" class="mesh-form">
          <div>
            <label id="label-mesh-start-url" for="mesh_start_url">URL de départ</label>
            <input id="mesh_start_url" name="mesh_start_url" type="url" placeholder="https://example.com/" required>
          </div>
          <div>
            <label id="label-mesh-max-pages" for="mesh_max_pages">Max pages</label>
            <input id="mesh_max_pages" name="mesh_max_pages" type="number" min="10" max="300" value="80">
          </div>
          <div>
            <label id="label-mesh-timeout" for="mesh_timeout">Timeout (s)</label>
            <input id="mesh_timeout" name="mesh_timeout" type="number" min="3" max="30" value="12">
          </div>
          <div class="actions" style="grid-column: 1/-1;">
            <button id="mesh-run-btn" type="submit">Analyser le maillage</button>
          </div>
        </form>
        <div id="mesh-form-error" class="danger" aria-live="polite"></div>
      </div>
    </div>

    <div class="card" id="result-card" style="display:none;">
      <div class="row">
        <strong id="job-section-title">Suivi du job</strong>
        <div class="download-actions">
          <a id="download-link" class="button-link" href="#" style="display:none;">Télécharger le CSV</a>
          <a id="conflicts-download-link" class="button-link" href="#" style="display:none;">Télécharger les conflits</a>
          <button id="share-report-btn" class="button-link secondary" type="button" style="display:none;">Copier l’URL du rapport</button>
        </div>
      </div>
      <div id="share-feedback" class="muted" style="display:none;"></div>
      <div id="status-box" class="status"></div>

      <div class="summary" id="summary" style="display:none;">
        <div class="kpi"><b id="kpi-total">0</b><span id="kpi-total-label">Pages analysées</span></div>
        <div class="kpi"><b id="kpi-ok">0</b><span id="kpi-ok-label">Sans problèmes</span></div>
        <div class="kpi"><b id="kpi-ko">0</b><span id="kpi-ko-label">Avec problèmes</span></div>
      </div>

      <div id="insights-box" class="status insights-panel" style="display:none;">
        <strong id="insights-title" class="insights-title">Insights clés</strong>
        <ul id="insights-list" class="insights-list"></ul>
        <div id="top-issues-box" class="insight-groups"></div>
      </div>

      <div id="run-error" class="danger" aria-live="polite"></div>
      <div id="diff-box" class="status diff-panel" style="display:none;"></div>
      <div id="history-box" class="muted"></div>

      <details>
        <summary id="logs-summary">Logs techniques</summary>
        <pre id="log-tail">Aucun log pour le moment.</pre>
      </details>
    </div>

    <div class="card csv-full-width" id="preview-card" style="display:none;">
      <strong id="preview-title">Aperçu du CSV</strong>
      <div class="filter-grid">
        <div>
          <label id="filter-issue-label" for="filter-issue">Filtre issue</label>
          <input id="filter-issue" type="text" placeholder="ex : noindex">
        </div>
        <div>
          <label id="filter-http-label" for="filter-status">HTTP</label>
          <select id="filter-status">
            <option value="all">Tous</option>
            <option value="200">200</option>
            <option value="not-200">Non 200</option>
          </select>
        </div>
        <div>
          <label id="filter-indexable-label" for="filter-indexable">Indexable</label>
          <select id="filter-indexable">
            <option value="all">Tous</option>
            <option value="true">Oui</option>
            <option value="false">Non</option>
          </select>
        </div>
        <div>
          <label id="filter-priority-label" for="filter-priority">Priorité</label>
          <select id="filter-priority">
            <option value="all">Toutes</option>
            <option value="critical">Critique</option>
            <option value="high">Haute</option>
            <option value="medium">Moyenne</option>
            <option value="low">Basse</option>
            <option value="none">Aucune</option>
          </select>
        </div>
        <div class="filter-actions">
          <button id="reset-filters-btn" class="filter-reset-btn" type="button">Réinitialiser les filtres</button>
        </div>
      </div>
      <div id="preview-meta" class="muted"></div>
      <div id="preview-error" class="danger" aria-live="polite"></div>
      <div id="table-wrap" class="table-wrap"></div>
    </div>

    <div class="card" id="mesh-card" style="display:none;">
      <div class="row">
        <strong id="mesh-section-title">Maillage interne minimal</strong>
      </div>
      <div id="mesh-status-box" class="status"></div>
      <div class="mesh-toolbar">
        <div id="mesh-interaction-hint" class="muted mesh-interaction-hint">Cliquez sur un nœud pour isoler ses liens.</div>
        <div class="mesh-toolbar-actions">
          <button type="button" id="share-mesh-btn" class="mesh-control-btn" style="display:none;">Copier l’URL du maillage</button>
          <button type="button" id="mesh-reset-focus-btn" class="mesh-control-btn" disabled>Réinitialiser le focus</button>
          <button type="button" id="mesh-reset-view-btn" class="mesh-control-btn">Réinitialiser la vue</button>
        </div>
      </div>
      <div id="share-mesh-feedback" class="muted" style="font-size:12px; min-height:16px; margin-bottom:8px; display:none;"></div>
      <div class="mesh-graph-wrap">
        <svg id="mesh-graph" viewBox="0 0 960 500" preserveAspectRatio="xMidYMid meet"></svg>
        <div id="mesh-hover-tooltip" class="mesh-hover-tooltip" aria-hidden="true"></div>
      </div>
      <div id="mesh-meta" class="muted"></div>
      <div id="mesh-kpis" class="mesh-kpis"></div>
      <div id="mesh-warnings" class="mesh-warnings"></div>
      <div id="mesh-actions" class="mesh-actions"></div>
      <div id="mesh-summary" class="mesh-summary"></div>
      <div id="mesh-errors" class="danger"></div>
    </div>

    <footer class="app-footer">
      <span id="footer-credit-prefix">Créé par</span>
      <a href="https://tommy-bordas.fr" target="_blank" rel="noopener noreferrer">tommy-bordas.fr</a>
    </footer>
  </div>

  <script src="i18n.js"></script>
  <script src="app.js"></script>
</body>
</html>
